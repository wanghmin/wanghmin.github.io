<style>
  /* Left-floated thumbnail */
  .pub-thumb-inline {
    float: left;
    width: 96px;
    height: 96px;
    object-fit: cover;
    border-radius: 6px;
    margin-right: 12px; /* ensure text doesn't overlap */
    background: #f2f2f2;
  }

  /* Ensure citation text stays aligned in the right column */
  .pub-body-wrap {
    overflow: hidden;
    display: block; /* ensure right content does not wrap around */
    padding-top: 4px; /* small adjustment to keep balance */
  }

  /* Prevent layout issues if no image is found */
  .pub-list-item.view-citation.no-thumb .pub-thumb-inline {
    display: none;
  }
</style>

<script>
(function addPubThumbs() {
  const items = Array.from(document.querySelectorAll('.pub-list-item.view-citation'));
  if (!items.length) return;

  const names = ['featured','teaser','thumb','thumbnail','cover','image'];
  const exts  = ['png','webp','jpg','jpeg','gif'];

  items.forEach((el) => {
    if (el.dataset.thumbAdded === '1') return;
    el.dataset.thumbAdded = '1';

    // Find the paper page link (e.g., /publication/yuan-2024-vhk/)
    const a = el.querySelector('a[href*="/publication/"]') || el.querySelector('a.underline');
    if (!a) return;

    // Build the base folder URL
    const base = new URL(a.getAttribute('href'), document.baseURI);
    if (!base.pathname.endsWith('/')) base.pathname += '/';

    // Create an array of possible image file names and extensions
    const candidates = [];
    for (const n of names) for (const e of exts) {
      candidates.push(new URL(n + '.' + e, base).href);
    }

    // Create the <img> and wrap it in an anchor link
    const img = document.createElement('img');
    img.className = 'pub-thumb-inline';
    img.loading = 'lazy';
    img.decoding = 'async';
    img.alt = 'thumbnail';

    const thumbLink = document.createElement('a');
    thumbLink.href = a.href;
    thumbLink.appendChild(img);

    // Create right-column wrapper to contain the citation content
    const bodyWrap = document.createElement('div');
    bodyWrap.className = 'pub-body-wrap';

    // Insert the thumbnail first, then wrap the content
    el.insertBefore(thumbLink, el.firstChild);
    while (thumbLink.nextSibling) {
      bodyWrap.appendChild(thumbLink.nextSibling);
    }
    el.appendChild(bodyWrap);

    // Try each image URL until one loads successfully
    let i = 0;
    function tryNext() {
      if (i >= candidates.length) {
        el.classList.add('no-thumb');
        return;
      }
      img.src = candidates[i++];
    }
    img.onerror = tryNext;
    img.onload = () => {};  // keep image once it loads

    tryNext();
  });
})();
</script>
