<style>
  /* Small, floated thumbnail that doesn’t alter the item’s layout */
  .pub-thumb-inline {
    float: left;
    width: 96px;
    height: 96px;
    object-fit: cover;
    border-radius: 6px;
    margin: 4px 12px 6px 0;
    background: #f2f2f2;
  }
  /* Contain the float so links/attachments don’t overlap it */
  .pub-list-item.view-citation { overflow: auto; }
</style>

<script>
(function addPubThumbs(){
  const items = Array.from(document.querySelectorAll('.pub-list-item.view-citation'));
  if (!items.length) return;

  items.forEach(async (el) => {
    if (el.dataset.thumbAdded === '1') return; // guard
    el.dataset.thumbAdded = '1';

    // Find the publication page link (e.g., /publication/yuan-2024-vhk/)
    const a = el.querySelector('a[href*="/publication/"]') || el.querySelector('a.underline');
    if (!a) return;

    // Build absolute base URL to the folder
    const base = new URL(a.getAttribute('href'), location.origin);
    if (!base.pathname.endsWith('/')) base.pathname += '/';

    // Only try featured.* in that folder (you can add more names if needed)
    const candidates = ['featured.png','featured.webp','featured.jpg','featured.jpeg','featured.gif']
      .map(name => new URL(base.pathname + name, base).href);

    const src = await firstLoadable(candidates);
    if (!src) return;

    // Create an inline floated thumbnail and insert as the very first child
    const img = document.createElement('img');
    img.className = 'pub-thumb-inline';
    img.loading = 'lazy';
    img.decoding = 'async';
    img.alt = 'thumbnail';
    img.src = src;

    // Make the image clickable: link to the publication page
    const link = document.createElement('a');
    link.href = a.href;
    link.appendChild(img);

    el.insertBefore(link, el.firstChild);
  });

  function firstLoadable(urls){
    // Try sequentially; resolve with first that loads
    return new Promise(async (resolve) => {
      for (const u of urls) {
        try {
          await loadImage(u);
          return resolve(u);
        } catch {}
      }
      resolve(null);
    });
  }

  function loadImage(url){
    return new Promise((resolve, reject) => {
      const i = new Image();
      i.onload = () => resolve(url);
      i.onerror = reject;
      i.src = url;
    });
  }
})();
</script>
