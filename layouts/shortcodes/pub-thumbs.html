<style>
/* Set up the container to use flexbox */
.pub-list-item.view-citation {
  display: flex;
  align-items: flex-start;
  margin-bottom: 1rem; /* Adjust as needed */
}

/* Left column for the image */
.pub-thumb-inline {
  width: 96px;  /* Enforce width */
  height: 96px; /* Enforce height */
  object-fit: cover; /* Maintain aspect ratio while filling the area */
  border-radius: 6px;
  background: #f2f2f2;
  margin-right: 12px; /* Space between image and text */
}

/* Right column for the text */
.pub-citation-text {
  flex: 1; /* Makes sure the text takes the remaining space */
}

/* Media query for narrow screens (like mobile devices) */
@media (max-width: 768px) {
  /* Hide the image and just show text */
  .pub-thumb-inline {
    display: none;
  }

  /* Adjust text to take full width */
  .pub-citation-text {
    flex: 1;
  }
}
</style>

<script>
(function addPubThumbs(){
  // Wait until the list is present (helps if hydration/JS reflows late)
  function ready(fn){
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fn);
    } else {
      fn();
    }
    window.addEventListener('load', () => setTimeout(fn, 0));
  }

  ready(() => {
    const items = Array.from(document.querySelectorAll('.pub-list-item.view-citation'));
    if (!items.length) return;

    const names = ['featured','teaser','thumb','thumbnail','cover','image'];
    const exts  = ['png','webp','jpg','jpeg','gif'];

    let counter = 0;  // Initialize counter for alternating layout

    items.forEach((el) => {
      if (el.dataset.thumbAdded === '1') return;
      el.dataset.thumbAdded = '1';

      // Find the publication page link (e.g., /publication/yuan-2024-vhk/)
      const a = el.querySelector('a[href*="/publication/"]') || el.querySelector('a.underline');
      if (!a) return;

      // Base folder URL, robust to subpaths/domains.
      const base = new URL(a.getAttribute('href'), document.baseURI);
      if (!base.pathname.endsWith('/')) base.pathname += '/';

      // Build candidate URLs in that folder
      const candidates = [];
      for (const n of names) for (const e of exts) {
        candidates.push(new URL(n + '.' + e, base).href);
      }

      // Create the <img>, try each candidate sequentially using onerror
      const img = document.createElement('img');
      img.className = 'pub-thumb-inline';
      img.loading = 'lazy';
      img.decoding = 'async';
      img.alt = 'thumbnail';

      let i = 0;
      function tryNext(){
        if (i >= candidates.length) { img.remove(); return; }
        const url = candidates[i++];
        img.src = url; // this will trigger a network request you can see in DevTools
      }
      img.onerror = tryNext;
      img.onload  = () => { /* success: keep it */ };

      // Create a wrapper for the citation text
      const textColumn = document.createElement('div');
      textColumn.classList.add('pub-citation-text');
      textColumn.innerHTML = el.innerHTML; // Copy the citation text

      // Clear the original content
      el.innerHTML = ''; // Clear existing content

      // Alternate the image position in each row
      if (counter % 2 === 0) {
        // Image on the left, text on the right
        const imageColumn = document.createElement('div');
        imageColumn.classList.add('pub-thumb-inline');
        imageColumn.appendChild(img);
        el.appendChild(imageColumn);  // Left column with image
        el.appendChild(textColumn);  // Right column with text
      } else {
        // Image on the right, text on the left
        const imageColumn = document.createElement('div');
        imageColumn.classList.add('pub-thumb-inline');
        imageColumn.appendChild(img);
        el.appendChild(textColumn);  // Left column with text
        el.appendChild(imageColumn);  // Right column with image
      }

      // Kick off the first attempt for image loading
      tryNext();

      // Increment the counter to alternate for the next row
      counter++;
    });
  });
})();
</script>
