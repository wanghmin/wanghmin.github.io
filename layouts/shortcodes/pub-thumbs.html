<style>
  /* Each citation reserves a left gutter for the thumb */
  .pub-list-item.view-citation {
    position: relative;
    padding-left: 112px;    /* thumb width (96) + gap (16) */
    min-height: 96px;       /* ensure the row is tall enough for the thumb */
  }

  /* Absolutely-positioned thumb in the left gutter */
  .pub-thumb-wrap {
    position: absolute;
    left: 0;
    top: 4px;
  }
  .pub-thumb-abs {
    width: 96px;
    height: 96px;
    object-fit: cover;
    border-radius: 6px;
    background: #f2f2f2;
    display: block;
  }
</style>

<script>
(function addPubThumbs(){
  const items = Array.from(document.querySelectorAll('.pub-list-item.view-citation'));
  if (!items.length) return;

  const names = ['featured','teaser','thumb','thumbnail','cover','image'];
  const exts  = ['png','webp','jpg','jpeg','gif'];

  items.forEach((el) => {
    if (el.dataset.thumbAdded === '1') return;
    el.dataset.thumbAdded = '1';

    const a = el.querySelector('a[href*="/publication/"]') || el.querySelector('a.underline');
    if (!a) return;

    const base = new URL(a.getAttribute('href'), document.baseURI);
    if (!base.pathname.endsWith('/')) base.pathname += '/';

    const candidates = [];
    for (const n of names) for (const e of exts) {
      candidates.push(new URL(n + '.' + e, base).href);
    }

    const img = document.createElement('img');
    img.className = 'pub-thumb-abs';
    img.loading = 'lazy';
    img.decoding = 'async';
    img.alt = 'thumbnail';

    let i = 0;
    function tryNext(){
      if (i >= candidates.length) { wrap.remove(); return; }
      img.src = candidates[i++];  // will trigger a visible network request
    }
    img.onerror = tryNext;

    const wrap = document.createElement('a');
    wrap.className = 'pub-thumb-wrap';
    wrap.href = a.href;
    wrap.appendChild(img);

    // Insert the positioned thumb; all existing content stays in the padded right column
    el.insertBefore(wrap, el.firstChild);

    tryNext();
  });
})();
</script>
