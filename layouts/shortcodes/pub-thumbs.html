<style>
  /* Container for each publication item */
  .pub-list-item.view-citation {
    display: flex;
    align-items: flex-start;  /* Aligns items to the top (image and text at the top) */
    margin-bottom: 1rem;      /* Adjust spacing as needed */
  }

  /* Small, inline thumbnail image */
  .pub-thumb-inline {
    width: 32px;
    height: 32px;
    object-fit: cover;
    border-radius: 6px;
    margin-right: 12px;  /* Space between the image and text */
    background: #f2f2f2;
  }

  /* Container for text */
  .pub-list-item.view-citation .citation-text {
    display: block;
    flex-grow: 1;  /* Allow text to take available space */
  }
</style>


(function addPubThumbs(){
  // Wait until the list is present (helps if hydration/JS reflows late)
  function ready(fn){
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fn);
    } else {
      fn();
    }
    window.addEventListener('load', () => setTimeout(fn, 0));
  }

  ready(() => {
    const items = Array.from(document.querySelectorAll('.pub-list-item.view-citation'));
    if (!items.length) return;

    const names = ['featured','teaser','thumb','thumbnail','cover','image'];
    const exts  = ['png','webp','jpg','jpeg','gif'];

    items.forEach((el) => {
      if (el.dataset.thumbAdded === '1') return;
      el.dataset.thumbAdded = '1';

      // Find the publication page link (e.g., /publication/yuan-2024-vhk/)
      const a = el.querySelector('a[href*="/publication/"]') || el.querySelector('a.underline');
      if (!a) return;

      // Base folder URL, robust to subpaths/domains.
      const base = new URL(a.getAttribute('href'), document.baseURI);
      if (!base.pathname.endsWith('/')) base.pathname += '/';

      // Build candidate URLs in that folder
      const candidates = [];
      for (const n of names) for (const e of exts) {
        candidates.push(new URL(n + '.' + e, base).href);
      }

      // Create the <img>, try each candidate sequentially using onerror
      const img = document.createElement('img');
      img.className = 'pub-thumb-inline';
      img.loading = 'lazy';
      img.decoding = 'async';
      img.alt = 'thumbnail';

      let i = 0;
      function tryNext(){
        if (i >= candidates.length) { img.remove(); return; }
        const url = candidates[i++];
        img.src = url; // this will trigger a network request you can see in DevTools
      }
      img.onerror = tryNext;
      img.onload  = () => { /* success: keep it */ };

      // Insert image into the first column
      const link = document.createElement('a');
      link.href = a.href;
      link.appendChild(img);
      
      // Add the citation text into a div
      const citationText = el.querySelector('.citation-text') || document.createElement('div');
      citationText.className = 'citation-text';
      
      // Move text content into the citationText div
      citationText.innerHTML = el.innerHTML;
      el.innerHTML = '';  // Clear current content
      el.appendChild(link);  // Add the image link first
      el.appendChild(citationText);  // Add the text below the image

      // Kick off the first attempt
      tryNext();
    });
  });
})();

