<style>
  .pub-year {
    margin: 2rem 0 .75rem;
    font-weight: 600;
    font-size: 1.5rem;
    border-bottom: 1px solid rgba(0,0,0,.08);
    padding-bottom: .25rem;
  }
</style>

<script>
(function attachYearHeaders(){
  const root = document.querySelector('main') || document.body;
  if (!root) return;
  if (root.querySelector('.pub-year')) return; // avoid double insert

  // 1) Find all elements that LOOK like a citation line (contain "(YYYY)")
  const all = Array.from(root.querySelectorAll('*:not(script):not(style)'))
    .filter(el => {
      const txt = (el.textContent || '').replace(/\s+/g,' ').trim();
      if (txt.length < 20) return false;                // too short to be a citation
      if (!/\((19|20)\d{2}\)/.test(txt)) return false;  // no (YYYY)
      // Prefer block-ish elements so we donâ€™t grab inline spans
      const disp = getComputedStyle(el).display;
      return disp !== 'inline' && disp !== 'none';
    });

  if (!all.length) return;

  // 2) Keep only the TOPMOST elements that contain years (avoid nested duplicates)
  const items = all.filter(el => !all.some(other => other !== el && other.contains(el)));

  if (items.length < 2) return;

  // 3) Insert year headers before first item of each year
  const yearFromText = el => {
    const m = (el.textContent || '').match(/\((19|20)\d{2}\)/);
    return m ? m[0].slice(1,5) : '';
  };

  let last = '';
  items.forEach(el => {
    const y = yearFromText(el);
    if (y && y !== last) {
      const h = document.createElement('h2');
      h.className = 'pub-year';
      h.id = 'y-' + y;
      h.textContent = y;
      el.parentNode && el.parentNode.insertBefore(h, el);
      last = y;
    }
  });
})();
</script>
