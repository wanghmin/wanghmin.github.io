{{ define "main" }}
<h1>Publications</h1>

{{ $grouped := dict }}

{{ range .Pages }}
  {{ $year := .Params.year }}
  {{ if not $year }}  <!-- If year is missing, set a default value (e.g., current year) -->
    {{ $year = "Unknown" }}
  {{ end }}
  
  {{ with index $grouped $year }}
    <!-- Append the publication to the existing slice for the year -->
    {{ $grouped = merge $grouped (dict $year (append . (dict "title" .Title "url" .Permalink))) }}
  {{ else }}
    <!-- Create a new slice for the year if it doesn't exist -->
    {{ $grouped = merge $grouped (dict $year (slice (dict "title" .Title "url" .Permalink))) }}
  {{ end }}
{{ end }}

{{ range $year, $publications := $grouped }}
  <h2>{{ $year }}</h2>
  <ul>
    {{ range $publications }}
      <li><a href="{{ .url }}">{{ .title }}</a></li>
    {{ end }}
  </ul>
{{ end }}

{{ end }}