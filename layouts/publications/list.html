{{ define "main" }}
<h1>Publications</h1>

{{ $grouped := dict }} <!-- Initialize an empty map for grouping publications by year -->

{{ range .Pages }}
  {{ $year := .Params.year }}
  {{ if not $year }} <!-- If year is missing, assign a default value -->
    {{ $year = "Unknown" }}
  {{ end }}

  {{ $publication := dict "title" .Title "url" .Permalink }} <!-- Create a map for each publication -->

  {{ with index $grouped $year }} <!-- Check if the year already exists in the map -->
    {{ $grouped = merge $grouped (dict $year (append (index $grouped $year) $publication)) }} <!-- Append to the existing slice -->
  {{ else }}
    {{ $grouped = merge $grouped (dict $year (slice $publication)) }} <!-- Create a new slice for this year -->
  {{ end }}
{{ end }}

<!-- Now display the grouped publications -->
{{ range $year, $publications := $grouped }}
  <h2>{{ $year }}</h2>
  <ul>
    {{ range $publications }}
      <li><a href="{{ .url }}">{{ .title }}</a></li>
    {{ end }}
  </ul>
{{ end }}

{{ end }}