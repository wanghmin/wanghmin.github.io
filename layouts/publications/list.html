{{ define "main" }}
<h1>Publications</h1>

{{ $grouped := dict }} <!-- Initialize the empty map -->

{{ range .Pages }}
  {{ $year := .Params.year }}
  {{ if not $year }}  <!-- If year is missing, set a default value (e.g., "Unknown") -->
    {{ $year = "Unknown" }}
  {{ end }}

  {{ $publication := dict "title" .Title "url" .Permalink }} <!-- Create the publication map -->
  
  {{ with index $grouped $year }}
    <!-- If the year exists, append the publication to the existing slice -->
    {{ $grouped = merge $grouped (dict $year (append (index $grouped $year) $publication)) }}
  {{ else }}
    <!-- If the year doesn't exist, create a new slice with this publication -->
    {{ $grouped = merge $grouped (dict $year (slice $publication)) }}
  {{ end }}
{{ end }}

<!-- Loop through the grouped publications and display them -->
{{ range $year, $publications := $grouped }}
  <h2>{{ $year }}</h2>
  <ul>
    {{ range $publications }}
      <li><a href="{{ .url }}">{{ .title }}</a></li>
    {{ end }}
  </ul>
{{ end }}

{{ end }}