{{ define "main" }}
<main class="container mx-auto px-4">

  {{/* Collect publications */}}
  {{ $pubs := where .Site.RegularPages "Type" "publication" }}
  {{ if eq (len $pubs) 0 }}
    {{ $pubs = where .Site.RegularPages "Section" "publication" }}
  {{ end }}

  {{ if eq (len $pubs) 0 }}
    <p>No publications found.</p>
  {{ else }}
    {{ $sorted := $pubs.ByDate.Reverse }}
    {{ $currentYear := "" }}

    {{ range $p := $sorted }}
      {{/* Determine year */}}
      {{ $y := cond $p.Params.publication_year (printf "%v" $p.Params.publication_year) ($p.Date.Format "2006") }}

      {{ if ne $y $currentYear }}
        {{ if ne $currentYear "" }}</ul></section>{{ end }}
        <section id="y-{{ $y }}" class="mb-8">
          <h2 class="year-heading text-2xl font-semibold mt-10 mb-4">{{ $y }}</h2>
          <ul class="list-none space-y-3">
        {{ $currentYear = $y }}
      {{ end }}

      {{/* Core citation pieces */}}
      {{ $authors := delimit ($p.Params.authors | default (slice)) ", " }}
      {{ $venue := cond $p.Params.publication $p.Params.publication $p.Params.journal }}
      {{ $vol := $p.Params.volume }}
      {{ $num := $p.Params.number }}

      {{/* Best link target for title */}}
      {{ $link := $p.RelPermalink }}
      {{ if $p.Params.url_pdf }}{{ $link = $p.Params.url_pdf }}{{ end }}
      {{ if $p.Params.url_custom }}{{ $link = $p.Params.url_custom }}{{ end }}

      <li class="pub-item leading-snug">
        {{ with $authors }}{{ . }}{{ end }}
        {{ if $y }} ({{ $y }}).{{ end }}
        <a href="{{ $link }}" class="pub-title font-medium italic hover:underline">{{ $p.Title }}</a>.
        {{ with $venue }} <em>{{ . }}</em>{{ end }}
        {{ if or $vol $num }}
          {{ if $vol }}, {{ $vol }}{{ end }}
          {{ if $num }}({{ $num }}){{ end }}
        {{ end }}.
        {{/* â† final period included */}}

        {{/* --- Link Icons --- */}}
        <span class="pub-links ml-2 space-x-1 text-sm">
          {{ with $p.Params.url_pdf }}<a href="{{ . }}" class="link-icon" title="PDF">ğŸ“„ PDF</a>{{ end }}
          {{ with $p.Params.url_cite }}<a href="{{ . }}" class="link-icon" title="BibTeX">ğŸ“‘ CITE</a>{{ end }}
          {{ with $p.Params.url_code }}<a href="{{ . }}" class="link-icon" title="Code">ğŸ’» CODE</a>{{ end }}
          {{ with $p.Params.url_dataset }}<a href="{{ . }}" class="link-icon" title="Dataset">ğŸ“Š DATA</a>{{ end }}
          {{ with $p.Params.url_project }}<a href="{{ . }}" class="link-icon" title="Project Page">ğŸŒ PAGE</a>{{ end }}
          {{ with $p.Params.url_video }}<a href="{{ . }}" class="link-icon" title="Video">ğŸ¬ VIDEO</a>{{ end }}
        </span>
      </li>

    {{ end }}
    {{ if ne $currentYear "" }}</ul></section>{{ end }}
  {{ end }}
</main>

<style>
.year-heading {
  border-bottom: 1px solid rgba(0,0,0,.08);
  padding-bottom: .25rem;
}
.pub-item {
  margin-left: 1rem;
  text-indent: -1rem;
}
.pub-links a {
  text-decoration: none;
  opacity: 0.75;
}
.pub-links a:hover {
  text-decoration: underline;
  opacity: 1;
}
</style>
{{ end }}
